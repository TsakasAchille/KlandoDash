{
  "stats": {
    "panel_name": "stats",
    "description": "Panneau des statistiques d'un trajet",
    "methods": {
      "cache": {
        "html_cache_enabled": true,
        "redis_cache_enabled": true,
        "redis_key_prefix": "trip_stats",
        "cache_ttl": 300
      },
      "data_fetcher": {
        "type": "rest",
        "inputs": {
          "trip_id": "required"
        },
        "rest_config": {
          "endpoint": "get_trip_stats",
          "method": "GET",
          "params": {
            "trip_id": "trip_id"
          }
        },
        "sql_config": {
          "main_table": "trips",
          "joins": [
            {
              "table": "bookings",
              "condition": "bookings.trip_id = trips.trip_id",
              "type": "LEFT"
            }
          ],
          "where_conditions": [
            "trips.trip_id = :trip_id"
          ],
          "fields": {
            "prix_par_place": {
              "label": "Prix par place",
              "table": "trips",
              "column": "price_per_seat",
              "unit": "FCFA",
              "type": "currency"
            },
            "prix_conducteur": {
              "label": "Prix conducteur",
              "table": "trips", 
              "column": "driver_earnings",
              "unit": "FCFA",
              "type": "currency"
            },
            "nombre_places": {
              "label": "Nombre de places",
              "table": "trips",
              "column": "total_seats",
              "type": "integer"
            },
            "places_disponibles": {
              "label": "Places disponibles",
              "table": "trips",
              "column": "available_seats",
              "type": "integer"
            },
            "reservations": {
              "label": "Réservations",
              "table": "bookings",
              "column": "COUNT(*)",
              "type": "count",
              "group_by": true
            },
            "statut": {
              "label": "Statut",
              "table": "trips",
              "column": "status",
              "type": "enum",
              "values": {
                "active": "Actif",
                "completed": "Terminé",
                "cancelled": "Annulé",
                "pending": "En attente"
              }
            }
          }
        }
      },
      "renderer": {
        "type": "function",
        "inputs": {
          "trip_id": "required",
          "data": "required"
        },
        "module": "dash_apps.components.trip_stats",
        "function": "render_trip_stats"
      }
    }
  },
  "details": {
    "panel_name": "details",
    "description": "Panneau des détails complets d'un trajet",
    "methods": {
      "cache": {
        "html_cache_enabled": true,
        "redis_cache_enabled": true,
        "redis_key_prefix": "trip_details",
        "cache_ttl": 300
      },
      "data_fetcher": {
        "type": "rest",
        "inputs": {
          "trip_id": "required"
        },
        "rest_config": {
          "endpoint": "get_trip_details",
          "method": "GET",
          "params": {
            "trip_id": "trip_id"
          }
        },
        "sql_config": {
          "main_table": "trips",
          "joins": [
            {
              "table": "users",
              "condition": "users.uid = trips.driver_id",
              "type": "LEFT"
            }
          ],
          "where_conditions": [
            "trips.trip_id = :trip_id"
          ],
          "fields": {
            "trip_id": {
              "label": "ID Trajet",
              "table": "trips",
              "column": "trip_id",
              "type": "string"
            },
            "departure_location": {
              "label": "Départ",
              "table": "trips",
              "column": "departure_name",
              "type": "string"
            },
            "arrival_location": {
              "label": "Arrivée", 
              "table": "trips",
              "column": "destination_name",
              "type": "string"
            },
            "departure_time": {
              "label": "Heure de départ",
              "table": "trips",
              "column": "departure_schedule",
              "type": "datetime"
            },
            "driver_name": {
              "label": "Conducteur",
              "table": "users",
              "column": "display_name",
              "type": "string"
            }
          }
        }
      },
      "renderer": {
        "type": "function",
        "inputs": {
          "trip_id": "required",
          "data": "required"
        },
        "module": "dash_apps.components.trip_details_layout",
        "function": "create_trip_details_layout"
      }
    }
  },
  "passengers": {
    "panel_name": "passengers",
    "description": "Panneau des passagers d'un trajet",
    "methods": {
      "cache": {
        "html_cache_enabled": true,
        "redis_cache_enabled": true,
        "redis_key_prefix": "trip_passengers",
        "cache_ttl": 180
      },
      "data_fetcher": {
        "type": "rest",
        "inputs": {
          "trip_id": "required"
        },
        "rest_config": {
          "endpoint": "get_trip_passengers",
          "method": "GET",
          "params": {
            "trip_id": "trip_id"
          }
        },
        "sql_config": {
          "main_table": "bookings",
          "joins": [
            {
              "table": "trips",
              "condition": "bookings.trip_id = trips.trip_id",
              "type": "LEFT"
            },
            {
              "table": "users",
              "condition": "bookings.user_id = users.uid",
              "type": "LEFT"
            }
          ],
          "where_conditions": [
            "trips.trip_id = :trip_id"
          ],
          "fields": {
            "passenger_name": {
              "label": "Nom du passager",
              "table": "users",
              "column": "display_name",
              "type": "string"
            },
            "pickup_location": {
              "label": "Lieu de prise en charge",
              "table": "bookings",
              "column": "pickup_location",
              "type": "string"
            },
            "seats_booked": {
              "label": "Places réservées",
              "table": "bookings", 
              "column": "seats_count",
              "type": "integer"
            }
          }
        }
      },
      "renderer": {
        "type": "function",
        "inputs": {
          "trip_id": "required",
          "data": "required"
        },
        "module": "dash_apps.components.trip_passengers_panel",
        "function": "render_trip_passengers_panel"
      }
    }
  }
}
